'use strict';var dragScale=function(a,b,c){this.svgEle=a,this.resetBtn=c,this.radarBoxEle=b,this.init.apply(this)};dragScale.prototype={constructor:dragScale,_dom:{},_x:0,_y:0,_top:0,_left:0,move:!1,down:!1,boxEle:null,radarAreaSize:{width:0,height:0},radarCurrentMsg:{width:0,height:0,left:0,top:0},svgSize:{width:0,height:0},boxSize:{width:0,height:0},mousePosition:{},currentVBArr:[],originVBArr:[],init:function init(){this.WHRatio={},this.radarEle=this.radarBoxEle.children('.areaWrap'),this.currentRadarEle=this.radarEle.siblings('.currentArea'),this.radarAreaSize.width=parseInt(this.radarBoxEle.css('width')),this.boxEle=this.svgEle.parent('.dqmx-svgContainer'),this.svgSize.width=parseInt(this.svgEle.css('width')),this.svgSize.height=parseInt(this.svgEle.css('height')),this.boxEle.css({width:'100%',height:'100%'}),this.boxSize.width=parseInt(this.boxEle.css('width')),this.boxSize.height=parseInt(this.boxEle.css('height')),this.WHRatio.box=this.boxSize.width/this.boxSize.height,this.WHRatio.svg=this.svgSize.width/this.svgSize.height,this.boxSize.width>this.svgSize.width&&this.boxEle.css('width',this.svgSize.width+'px'),this.boxSize.height>this.svgSize.height&&this.boxEle.css('height',this.svgSize.height+'px'),this.boxSize.width=parseInt(this.boxEle.css('width')),this.boxSize.height=parseInt(this.boxEle.css('height')),this.currentVBArr=this.svgEle[0].attributes.viewBox.nodeValue.split(' '),this.radarAreaSize.height=this.radarAreaSize.width*this.svgSize.height/this.svgSize.width,this.radarBoxEle.css({height:this.radarAreaSize.height+'px'}),this.radarCurrentMsg.left=this.currentVBArr[0]/this.svgSize.width*this.radarAreaSize.width,this.radarCurrentMsg.top=this.currentVBArr[1]/this.svgSize.height*this.radarAreaSize.height,this.goRadarCurrent(),this.bindEvent();var b=this.svgSize.width*this.svgSize.width/this.radarAreaSize.width,c=b*this.svgSize.height/this.svgSize.width,d=this.svgSize.height*this.svgSize.height/this.radarAreaSize.height;if(c>d)this.radarBoxEle.children('.areaMap').children('svg')[0].setAttribute('viewBox','0 0 '+b+' '+c);else{var g=d*this.svgSize.width/this.svgSize.height;this.radarBoxEle.children('.areaMap').children('svg')[0].setAttribute('viewBox','0 0 '+g+' '+d)}this.WHRatio.box>this.WHRatio.svg?this.boxEle.css('width',this.boxSize.height*this.svgSize.width/this.svgSize.height+'px'):this.boxEle.css('height',this.svgSize.height*this.boxSize.width/this.svgSize.width+'px'),this.boxSize.width=parseInt(this.boxEle.css('width')),this.boxSize.height=parseInt(this.boxEle.css('height'));var f=[0,0];f[2]=this.svgSize.width*this.svgSize.width/this.boxSize.width,f[3]=f[2]/this.WHRatio.svg,this.mouseScroll(1,f),this.originVBArr=f,this.maxVB={},this.maxVB.width=f[2],this.maxVB.height=f[3]},bindEvent:function bindEvent(){var a=this;$('body.station').unbind('mouseup'),$('body.station').unbind('mousemove'),$('body.station').unbind('mousedown'),$('body.station').on('mousedown','svg',function(b){b&&b.preventDefault(),a.move||a.mouseDown(b)}),$('body.station').on('mouseup','svg',function(b){a.mouseUp(b)}),$('body.station').on('mousemove','svg',function(b){a.down&&a.mouseMove(b)}),this.radarEle.unbind('click'),this.radarEle.on('click',function(b){a.radarCurrentMsg.left=b.offsetX-a.radarCurrentMsg.width/2,a.radarCurrentMsg.top=b.offsetY-a.radarCurrentMsg.height/2;var c=JSON.parse(JSON.stringify(a.currentVBArr));c[0]=a.svgSize.width*a.radarCurrentMsg.left/a.radarAreaSize.width,c[1]=a.svgSize.height*a.radarCurrentMsg.top/a.radarAreaSize.height,c[0]>=a.svgSize.width-a.boxSize.width*a.currentVBArr[2]/a.svgSize.width&&(c[0]=a.svgSize.width-a.boxSize.width*a.currentVBArr[2]/a.svgSize.width),0>c[0]&&(c[0]=0),c[1]>=a.svgSize.height-a.boxSize.height*a.currentVBArr[3]/a.svgSize.height&&(c[1]=a.svgSize.height-a.boxSize.height*a.currentVBArr[3]/a.svgSize.height),0>c[1]&&(c[1]=0),a.moveToPosition(c)}),this.boxEle[0].onmousewheel=this.scrollFunc.bind(this),this.boxEle[0].addEventListener('DOMMouseScroll',this.scrollFunc.bind(this),!1),this.resetBtn.unbind('click'),this.resetBtn.on('click',function(){a.moveToPosition(a.originVBArr)})},mouseMove:function mouseMove(a){a&&a.preventDefault(),this.move=!0;var b=this.currentVBArr,c=(this._x-a.clientX)*b[2]/this.svgSize.width,d=(this._y-a.clientY)*b[2]/this.svgSize.width,f=parseFloat(b[0])+c,g=parseFloat(b[1])+d;0>f&&(f=0),f>=this.svgSize.width-this.boxSize.width*this.currentVBArr[2]/this.svgSize.width&&(f=this.svgSize.width-this.boxSize.width*this.currentVBArr[2]/this.svgSize.width,0>f&&(f=0)),0>g&&(g=0),g>=this.svgSize.height-this.boxSize.height*this.currentVBArr[3]/this.svgSize.height&&(g=this.svgSize.height-this.boxSize.height*this.currentVBArr[3]/this.svgSize.height,0>g&&(g=0)),this.radarCurrentMsg.left=f/this.svgSize.width*this.radarAreaSize.width,this.radarCurrentMsg.top=g/this.svgSize.height*this.radarAreaSize.height,this.svgEle[0].setAttribute('viewBox',f+' '+g+' '+b[2]+' '+b[3]),this.goRadarCurrent()},mouseUp:function mouseUp(a){a&&a.preventDefault(),this.move=!1,this.down=!1,this.currentVBArr=this.svgEle[0].attributes.viewBox.nodeValue.split(' '),this.svgEle.css('cursor','')},mouseDown:function mouseDown(a){this.currentVBArr=this.svgEle[0].attributes.viewBox.nodeValue.split(' '),this.move=!1,this.down=!0,this._x=a.clientX,this._y=a.clientY,this.boxSize.width=parseInt(this.svgEle.parent('.dqmx-svgContainer').css('width')),this.boxSize.height=parseInt(this.svgEle.parent('.dqmx-svgContainer').css('height')),this._top=$('.dqmx-svgContainer').scrollTop(),this._left=$('.dqmx-svgContainer').scrollLeft(),this.svgEle.css('cursor','move')},scrollFunc:function scrollFunc(a){if(this.mousePosition.left=a.layerX,this.mousePosition.top=a.layerY,a=a||window.event,a.preventDefault(),a.wheelDelta){var b=0<a.wheelDelta?'0.9':'1.1';this.mouseScroll(b)}else if(a.detail){var b=0>a.detail?0.9:1.1;this.mouseScroll(b)}},mouseScroll:function mouseScroll(a,b){if(!b){var c=this.currentVBArr;c[2]*a>this.maxVB.width?(c[0]=c[1]=0,c[2]=this.maxVB.width,c[3]=this.maxVB.height):(c[0]=(c[2]-c[2]*a)/this.svgSize.width*this.mousePosition.left+parseFloat(c[0]),c[1]=(c[3]-c[3]*a)/this.svgSize.height*this.mousePosition.top+parseFloat(c[1]),c[2]*=a,c[3]*=a,0>c[0]?c[0]=0:c[0]>this.svgSize.width-c[2]*this.boxSize.width/this.svgSize.width&&(c[0]=this.svgSize.width-c[2]*this.boxSize.width/this.svgSize.width),0>c[1]?c[1]=0:c[1]>this.svgSize.height-c[3]*this.boxSize.height/this.svgSize.height&&(c[1]=this.svgSize.height-c[3]*this.boxSize.height/this.svgSize.height))}else var c=b;this.svgEle[0].setAttribute('viewBox',c[0]+' '+c[1]+' '+c[2]+' '+c[3]),this.currentVBArr=this.svgEle[0].attributes.viewBox.nodeValue.split(' '),this.radarCurrentMsg.left=this.currentVBArr[0]/this.svgSize.width*this.radarAreaSize.width,this.radarCurrentMsg.top=this.currentVBArr[1]/this.svgSize.height*this.radarAreaSize.height,this.goRadarCurrent()},moveToPosition:function moveToPosition(a){var b=this,c=50,d=(a[0]-b.currentVBArr[0])/c,f=(a[1]-b.currentVBArr[1])/c,g=(a[2]-b.currentVBArr[2])/c,h=(a[3]-b.currentVBArr[3])/c,j=1,k=setInterval(function(){j+=1,j<=c?b.svgEle[0].setAttribute('viewBox',parseFloat(b.currentVBArr[0])+d*j+' '+(parseFloat(b.currentVBArr[1])+f*j)+' '+(parseFloat(b.currentVBArr[2])+g*j)+' '+(parseFloat(b.currentVBArr[3])+h*j)):(clearInterval(k),k=null,b.currentVBArr=b.svgEle[0].attributes.viewBox.nodeValue.split(' '),b.radarCurrentMsg.left=b.currentVBArr[0]/b.svgSize.width*b.radarAreaSize.width,b.radarCurrentMsg.top=b.currentVBArr[1]/b.svgSize.height*b.radarAreaSize.height,b.goRadarCurrent())},5)},goRadarCurrent:function goRadarCurrent(){this.radarCurrentMsg.width=this.boxSize.width/(this.svgSize.width*this.svgSize.width/this.currentVBArr[2])*this.radarAreaSize.width,this.radarCurrentMsg.height=this.boxSize.height/(this.svgSize.height*this.svgSize.height/this.currentVBArr[3])*this.radarAreaSize.height,this.currentRadarEle.css({width:this.radarCurrentMsg.width+'px',height:this.radarCurrentMsg.height+'px',top:this.radarCurrentMsg.top+'px',left:this.radarCurrentMsg.left+'px'})}};